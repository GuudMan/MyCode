<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="utf-8">
  <title>学生列表</title>
  <link rel="stylesheet" href="layui/css/layui.css" media="all">
</head>
<body>

<table id="demo" lay-filter="test"></table>
<script src="layui/layui.js"></script>
<script src="./js/jquery-3.5.1.min.js"></script>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script>
  layui.use('table', function () {
    var table = layui.table;

    //第一个实例
    table.render({
      elem: '#demo'
      , height: 'full-10'
      , url: 'SelectAllStudent' //数据接口
      , method: 'get'
      , page: true //开启分页
      , cols: [[ //表头
        {field: 'studentId', title: '学号', width: 80, sort: true}
        , {field: 'name', title: '用户名', width: 120}
        , {field: 'sex', title: '性别', width: 80, sort: true}
        , {field: 'age', title: '年龄', width: 80}
        , {field: 'titelId', title: '选题', width: 180}
        , {field: 'teacherId', title: '教师编号', width: 100, sort: true}
        , {field: 'right', title: '操作', width: 160, toolbar: '#barDemo'}
      ]]
    });
    // 监听行事件

    //监听行工具事件
    table.on('tool(test)', function (obj) {
      var data = obj.data;
      //console.log(obj)
      if (obj.event === 'del') {
        layer.confirm('真的删除ID为：'+data.studentId+"的用户吗?", function(index){

          //console.log(data.p_id);
          //向服务端发送删除指令
          $.ajax({
            url: 'DelStudentByid',
            type:'get',
            data:{'id':data.studentId},//向服务端发送删除的id
            dataType: 'text',
            success:function(res){
              if(res == "success"){
                obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                // layer.close(index);
                // console.log(index);
                layer.msg("删除成功",{icon:1});
                // window.location.href="SelectAllTeacher"
              }
              else{
                layer.msg("删除失败",{icon:5});
              }
            }
          });
          layer.close(index);
        });
      } else if (obj.event === 'edit') {
        // 实现编辑的功能
        layer.open({  // 打开弹出层
          type: 2 // 2表示自定义弹出 1表示layui弹出层
          , title: '编辑学生信息'
          , content: 'EditStudent.html'
          , maxmin: true
          , area: ['500px', '600px']
          , btn: ['确定', '取消']
          , yes: function (index, layero) {
            // 得到回调的数值
            var studentId = $(layero).find('iframe')[0].contentWindow.studentId.value;
            var name = $(layero).find('iframe')[0].contentWindow.document.getElementById('name').value;
            var sex = $(layero).find('iframe')[0].contentWindow.document.getElementById('sex').value;
            var age = $(layero).find('iframe')[0].contentWindow.document.getElementById('age').value;
            var titleId = $(layero).find('iframe')[0].contentWindow.document.getElementById('titleId').value;
            var teacherId = $(layero).find('iframe')[0].contentWindow.document.getElementById('teacherId').value;

            // 同步数据表格中的数据
            obj.update({
              'studentId': studentId,
              'name': name,
              'sex': sex,
              'age': age,
              'titleId': titleId,
              'teacherId': teacherId

            })
            $.ajax({
              url: 'EditStudent?studentId=' + studentId + "&name=" + name + "&sex=" + sex + "&age=" + age + "&titleId=" + titleId + "&teacherId=" + teacherId,
              type: 'post',
              contentType: 'application/json;charset=utf-8',
              dataType: 'text',
              data: {
                'studentId': studentId,
                'name': name,
                'sex': sex,
                'age': age,
                'titleId': titleId,
                'teacherId': teacherId
              }
              , success: function (res) {
                layer.msg("编辑成功")
              },
              error: function (res) {
                layer.msg("编辑失败")
              }
            });
            layer.close(index); // 关闭弹出层
          }
          , success: function (layero, index) {
            var div = layero.find('iframe').contents().find("#useradminstudent");
            //  得到回调的数值
            var body = layer.getChildFrame('body', index);
            var iframeWindow = Window['layui-layer-iframe' + index];
            body.find('#studentId').val(data.studentId);// 将每个格中填充初始数据
            body.find('#name').val(data.name);
            body.find('#sex').val(data.sex);
            body.find('#age').val(data.age);
            body.find('#titleId').val(data.titleId);
            body.find('#teacherId').val(data.teacherId);
          }
        });
      }
    });


  });
</script>
</body>
</html>